
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
    typeof define === 'function' && define.amd ? define(['exports'], factory) :
    (factory((global.BloxHack = {})));
}(this, (function (exports) { 'use strict';
    var BloxHack=function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=20)}([function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s extends THREE.Mesh{constructor(t){super(),this.on_reset(t)}on_reset(t){let e=t.description||{};if(!e)return;if("string"==typeof e&&(e={art:e}),!this.description||e.color!=this.description.color||!this.material){let t=e.color||16711935,i=e.doublesided?THREE.DoubleSide:0,s=(e.alpha,0),o=e.texture?THREE.ImageUtils.loadTexture(e.texture):0,r=new THREE.MeshPhongMaterial({color:t,transparent:s,side:i,map:o});this.material&&this.material.dispose(),this.material=r}(!this.madeGeometry||this.description&&e.art&&this.description.art!=e.art)&&e.hasOwnProperty("art")&&(this.geometry=this.setGeometryFromString(e.art));let i=this;e.scale&&i.scale.set(e.scale.x,e.scale.y,e.scale.z),e.position&&i.position.set(e.position.x,e.position.y,e.position.z),e.orientation&&(i.rotation.x=e.orientation.x*Math.PI/180,i.rotation.y=e.orientation.y*Math.PI/180,i.rotation.z=e.orientation.z*Math.PI/180),void 0!==e.visible&&(i.visible=!!e.visible)}setGeometryFromString(t){this.madeGeometry=!0;let e=0,i=0;switch(t){case void 0:case 0:case null:case"ignore":i=this.setCustomGeometry();break;case"group":i=null;break;case"box":case"cube":i=new THREE.BoxBufferGeometry(1,1,1,16,16,16);break;case"sphere":i=new THREE.SphereGeometry(1,32,32);break;default:e=1,i=new THREE.SphereGeometry(1,16,16)}if(this.geometry&&this.geometry.dispose(),this.geometry=i,!e)return this.geometry;this.material&&(this.material.visible=!1);let s=t+"/scene.gltf",o=this;return(new THREE.GLTFLoader).load(s,t=>{if(!t||!t.scene)return;if(t.animations&&t.animations.length){let e=new THREE.AnimationMixer(t.scene);for(let i of t.animations)e.clipAction(i).play()}let e=(new THREE.Box3).setFromObject(t.scene),i=o.scale.length()/e.getSize(new THREE.Vector3).length()*2,s=e.getCenter(new THREE.Vector3).multiplyScalar(i);t.scene.scale.set(i,i,i),t.scene.position.sub(s),o.add(t.scene),this.material&&(this.material.visible=!1)}),this.geometry}setCustomGeometry(){throw new Error("You have to implement the method setCustomGeometry!")}on_add(t){let e=this;t.blox.query({instance:THREE.Object3D,all:!0}).forEach(t=>{e.add(t)})}}},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return o}),i.d(e,"c",function(){return r}),i.d(e,"e",function(){return n}),i.d(e,"d",function(){return a});class s extends THREE.Line2{constructor(t){let e=t.description,i=t.blox,s=new THREE.LineGeometry,o=new THREE.LineMaterial({color:16777215,linewidth:5,vertexColors:THREE.VertexColors,dashed:!1});o.resolution.set(window.innerWidth,window.innerHeight),super(s,o),this.myGeometry=s,this.first=i.query(e.first),this.second=i.query(e.second)}on_tick(t){if(!this.first||!this.second)return;let e=this.first.mesh.position,i=this.second.mesh.position,s=this.myGeometry,o=[],r=[],n=[e,i],a=new THREE.CatmullRomCurve3(n),h=Math.round(12*n.length),l=new THREE.Color;for(let t=0,e=h;t<e;t++){let i=a.getPoint(t/e);o.push(i.x,i.y,i.z),l.setHSL(t/e,1,.5),r.push(l.r,l.g,l.b)}s.setPositions(o),s.setColors(r),this.computeLineDistances(),s.verticesNeedUpdate=!0}}class o{constructor(t){let e=t.description;t.blox;this.thrust=e.thrust?new THREE.Vector3(e.thrust.x,e.thrust.y,e.thrust.z):new THREE.Vector3,this.force=e.force?new THREE.Vector3(e.force.x,e.force.y,e.force.z):new THREE.Vector3}on_tick(t){t.blox.mesh&&(this.force.add(this.thrust),t.blox.mesh.position.add(this.force),t.blox.mesh.position.y<2&&(t.blox.mesh.position.y=2,this.force.y=.5))}}class r{constructor(t){t.description,t.blox;this.angle=0}on_tick(t){if(!t.blox.mesh)return;this.angle+=.01,t.blox.mesh.position.set(30*Math.sin(this.angle),3,30*Math.cos(this.angle))}}class n{constructor(t){let e=t.description;t.blox;this.thrust=e.thrust?new THREE.Vector3(e.thrust.x,e.thrust.y,e.thrust.z):new THREE.Vector3,this.force=e.force?new THREE.Vector3(e.force.x,e.force.y,e.force.z):new THREE.Vector3}on_tick(t){t.blox.mesh&&((!this.focus||Math.random()<.011)&&(this.focus=new THREE.Vector3(20*Math.random()-10,20*Math.random(),20*Math.random()-10)),this.thrust.x=.01*(this.focus.x-blox.mesh.position.x)*interval,this.thrust.y=.01*(this.focus.y-blox.mesh.position.y)*interval,this.thrust.z=.01*(this.focus.z-blox.mesh.position.z)*interval,this.force.add(this.thrust),t.mesh.position.add(this.force))}}class a{constructor(t){let e=t.description,i=t.blox;this.props=e,this.focus=i.query(e)}on_tick(t){this.focus&&this.focus.mesh&&t.blox.mesh&&t.blox.mesh.lookAt(this.focus.mesh.position)}}},function(t,e,i){"use strict";i.d(e,"b",function(){return o}),i.d(e,"a",function(){return r});let s=0;class o{static getInstance(){return s||(s=new o),s}constructor(t){t.description,t.blox;if(s)return s;s=this,Ammo(),this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.overlappingPairCache=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.dynamicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.overlappingPairCache,this.solver,this.collisionConfiguration),this.dynamicsWorld.setGravity(new Ammo.btVector3(0,-10,0)),this.bodies=[]}addConstraint(t){this.dynamicsWorld.addConstraint(t)}addRigidBody(t){this.dynamicsWorld.addRigidBody(t),this.bodies.push(t)}on_tick(){this.dynamicsWorld.stepSimulation(1/60,10)}destroy(){Ammo.destroy(this.dynamicsWorld),Ammo.destroy(this.solver),Ammo.destroy(this.overlappingPairCache),Ammo.destroy(this.dispatcher),Ammo.destroy(this.collisionConfiguration)}}class r{constructor(t,e){if(!e.mesh)return;if(e.physical)return;this.props=t;let i=e.mesh.scale,s=e.mesh.position,r=i.length(),n=this.mass=t.mass||0,a=this.transform=0,h="sphere";e.mesh.geometry instanceof THREE.BoxBufferGeometry&&(h="box"),e.mesh.geometry instanceof THREE.SphereGeometry&&(h="sphere");let l=0;switch(h){case"sphere":l=this.shape=new Ammo.btSphereShape(r/2),(a=this.transform=new Ammo.btTransform).setIdentity(),a.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));break;default:l=this.shape=new Ammo.btBoxShape(new Ammo.btVector3(i.x/2,i.y/2,i.z/2)),(a=this.transform=new Ammo.btTransform).setIdentity(),a.setOrigin(new Ammo.btVector3(s.x,s.y,s.z))}let c=new Ammo.btVector3(0,0,0);n&&l.calculateLocalInertia(n,c);let p=new Ammo.btDefaultMotionState(a),d=new Ammo.btRigidBodyConstructionInfo(n,p,l,c);this.body=new Ammo.btRigidBody(d);this.trans=new Ammo.btTransform,this.body.setRestitution(.9),this.body.setActivationState(4),this.body.activate(),this.props.launch&&(this.body.applyCentralForce(new Ammo.btVector3(this.props.launch.x,this.props.launch.y,this.props.launch.z)),this.body.applyCentralImpulse(new Ammo.btVector3(this.props.launch.x,this.props.launch.y,this.props.launch.z))),o.getInstance().addRigidBody(this.body),t.joint&&this.testJoint(t)}testJoint(t){let e=o.getInstance().bodies,i=e[e.length-2],s=e[e.length-1],r=new Ammo.btTransform;r.setIdentity();let n=new Ammo.btTransform;n.setIdentity();let a=new Ammo.btSliderConstraint(i,s,r,n,!0);a.setLowerLinLimit(0),a.setUpperLinLimit(2),o.getInstance().addConstraint(a)}on_tick(t){let e=t.blox;if(!e.mesh)return;this.props.force&&this.body.applyCentralImpulse(new Ammo.btVector3(this.props.force.x,this.props.force.y,this.props.force.z));let i=this.body.getMotionState();if(i){i.getWorldTransform(this.trans);var s=this.trans.getOrigin(),o=this.trans.getRotation();e.mesh.position.set(s.x(),s.y(),s.z()),e.mesh.quaternion.set(o.x(),o.y(),o.z(),o.w())}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s extends THREE.WebGLRenderer{constructor(t){let e=t.description||{},i=t.blox;super({antialias:!0,alpha:XRSupport.supportsARKit()}),this.setSize(window.innerWidth,window.innerHeight),this.props=e,this.blox=i,this.clock=new THREE.Clock,this.scene=0,this.camera=0,this.pov=0;let s=!!window.supportsVR;this.PASSTHROUGH=XRSupport.supportsARKit(),this.PASSTHROUGH||s?this.xr=new XRSupport({renderer:this,updatePOV:this.updatePOV.bind(this),updateCamera:this.updateCamera.bind(this),updateScene:this.updateScene.bind(this),renderScene:this.renderScene.bind(this),createVirtualReality:!!s,shouldStartPresenting:!0,useComputervision:!1,worldSensing:!s,alignEUS:!s}):(document.body.appendChild(this.domElement),this.setAnimationLoop(this.render3.bind(this)))}updatePOV(t){this.pov&&(this.pov.matrixAutoUpdate=!1,this.pov.matrix.fromArray(t),this.pov.updateMatrixWorld())}updateCamera(t){this.camera&&this.camera.projectionMatrix.fromArray(t)}updateScene(){this.scene&&this.camera&&this.blox.on_event({blox:this.blox,name:"on_tick",interval:this.clock.getElapsedTime()})}renderScene(){this.scene&&this.camera&&this.render(this.scene,this.camera)}render3(){this.scene&&this.camera&&(this.updateScene(),this.renderScene())}reset(t,e,i){this.scene=t,this.camera=e,this.pov=e}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s extends THREE.PerspectiveCamera{constructor(t){let e=t.description||{},i=(t.blox,super(45,window.innerWidth/window.innerHeight,.1,1e3)),s=e.position||{x:0,y:1,z:10},o=e.lookat||{x:0,y:1,z:0};i.position.set(s.x,s.y,s.z),i.lookAt(o.x,o.y,o.z);var r=new THREE.PointLight(16777215,1,100);i.add(r)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s extends THREE.DirectionalLight{constructor(t){let e=t.description;t.blox;super(e),e.position&&this.position.set(e.position.x,e.position.y,e.position.z),this.target.position.set(0,0,0),this.castShadow=!0;let i=e.color||16776960,s=new THREE.SphereGeometry(3,16,16),o=new THREE.MeshBasicMaterial({color:i}),r=new THREE.Mesh(s,o);this.add(r)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s extends THREE.Mesh{constructor(t){let e=t.description;t.blox;var i=new THREE.SphereGeometry(-500,60,40),s={texture:{type:"t",value:THREE.ImageUtils.loadTexture(e.art)}};super(i,new THREE.ShaderMaterial({uniforms:s,vertexShader:"\n\t\t\tvarying vec2 vUV;\n\t\t\tvoid main() {  \n\t\t\t  vUV = uv;\n\t\t\t  vec4 pos = vec4(position, 1.0);\n\t\t\t  gl_Position = projectionMatrix * modelViewMatrix * pos;\n\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\tuniform sampler2D texture;  \n\t\t\tvarying vec2 vUV;\n\n\t\t\tvoid main() {  \n\t\t\t  vec4 sample = texture2D(texture, vUV);\n\t\t\t  gl_FragColor = vec4(sample.xyz, sample.w);\n\t\t\t}\n\t\t\t"})).renderDepth=1e3}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(0);let o=0;class r extends s.a{constructor(t){t.description,t.blox;super(t)}setCustomGeometry(){if(o)return o;let t=new THREE.Shape;return t.moveTo(.5,.5),t.bezierCurveTo(.5,.5,.4,0,0,0),t.bezierCurveTo(-.6,0,-.6,.7,-.6,.7),t.bezierCurveTo(-.6,1.1,-.3,1.54,.5,1.9),t.bezierCurveTo(1.2,1.54,1.6,1.1,1.6,.7),t.bezierCurveTo(1.6,.7,1.6,0,1,0),t.bezierCurveTo(.7,0,.5,.5,.5,.5),o=new THREE.ShapeBufferGeometry(t),this.madeGeometry=!0,o}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(0);class o extends s.a{constructor(t){let e=t.description,i=t.blox;e.art="sphere",super(e,i),this.props=e,(new THREE.FontLoader).load("fonts/helvetiker_bold.typeface.json",this.attachText.bind(this))}attachText(t){let e=this.props,i=e&&e.say?e.say:"nothing",s=e&&e.size?e.size:1,o=e&&e.height?e.height:1;e&&e.color&&e.color;var r=new THREE.TextGeometry(i,{font:t,size:s,height:o});this.geometry&&this.geometry.dispose(),this.geometry=r}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(0);class o extends s.a{constructor(t){let e=t.description,i=t.blox;e.art="sphere",super(e,i),this.props=e;let s=this.makeMaterial(e.say||"hello"),o=this.makeGeometry(1,1);this.material&&this.material.dispose(),this.material=s,this.geometry&&this.geometry.dispose(),this.geometry=o}makeGeometry(t,e){return new THREE.PlaneGeometry(t,e,10,10)}makeMaterial(t){CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,s,o){var r=Math.PI/180;i-t-2*o<0&&(o=(i-t)/2),s-e-2*o<0&&(o=(s-e)/2),this.beginPath(),this.moveTo(t+o,e),this.lineTo(i-o,e),this.arc(i-o,e+o,o,270*r,360*r,!1),this.lineTo(i,s-o),this.arc(i-o,s-o,o,0*r,90*r,!1),this.lineTo(t+o,s),this.arc(t+o,s-o,o,90*r,180*r,!1),this.lineTo(t,e+o),this.arc(t+o,e+o,o,180*r,270*r,!1),this.closePath()};let e=1024,i=document.createElement("canvas");i.width=e,i.height=1024;let s=i.getContext("2d");s.font="60pt Arial",s.fillStyle="#cc00cc",s.strokeStyle="#cc00cc",function(t,e,i,s,o,r){var n=e+s,a=i+o;t.beginPath(),t.strokeStyle="#30A030",t.lineWidth="6",t.moveTo(e+r,i),t.lineTo(n-r,i),t.quadraticCurveTo(n,i,n,i+r),t.lineTo(n,i+o-r),t.quadraticCurveTo(n,a,n-r,a),t.lineTo(e+r,a),t.quadraticCurveTo(e,a,e,a-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.stroke()}(s,10,10,1004,1004,5),function(t,e,i,s,o,r){for(var n=e.split(" "),a="",h=0;h<n.length;h++){var l=a+n[h]+" ";t.measureText(l).width>o&&h>0?(t.fillText(a,i,s),a=n[h]+" ",s+=r):a=l}t.fillText(a,i,s)}(s,t,60,92,904,62);let o=new THREE.Texture(i);return o.needsUpdate=!0,new THREE.MeshBasicMaterial({map:o})}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t){this.blox=t.blox,this.on_reset(t)}on_reset(t){if(t.description instanceof Array)return this.sequence_counter=0,this.sequence_latch=0,void(this.sequence=t.description);this.on_do(t)}on_do(t){let e=t.description||{},i=this.blox;if(e.hasOwnProperty("reset")&&(this.sequence_counter=parseInt(e.reset),this.sequence_latch=0),this.isInitialized&&!e.reset||(this.isInitialized=!0,this.player=0,this.mesh=i?i.query({property:"isObject3D"}):0,this.position=this.mesh?this.mesh.position.clone():new THREE.Vector3,this.quaternion=this.mesh?this.mesh.quaternion.clone():new THREE.Quaternion,this.velocity=new THREE.Vector3,this.angular=new THREE.Quaternion,this.forces={},this.friction=.9,this.speed=1,this.mass=1,this.destination=0,this.facing=0,this.inverse_kinematics=!1,this.any_kinematics=!1,this.modifier_eyelevel=0,this.modifier_ground=0,this.modifier_wall=0,this.modifier_billboard=0,this.modifier_tagalong=0),e.hasOwnProperty("player")&&(this.player=i?i.query(e.player):0),e.hasOwnProperty("position"))if("string"==typeof e.position){let t=i?i.query({name:e.position,property:isObject3D}):0;t&&(this.position=t.position.clone())}else this.position=new THREE.Vector3(e.position.x,e.position.y,e.position.z);e.hasOwnProperty("destination")&&(this.destination=e.destination,this.any_kinematics=!0,this.inverse_kinematics=!0),e.hasOwnProperty("facing")&&(this.facing=e.facing),e.hasOwnProperty("friction")&&(this.friction=e.friction),e.hasOwnProperty("velocity")&&(this.velocity=new THREE.Vector3(e.velocity.x,e.velocity.y,e.velocity.z),this.any_kinematics=!0),e.hasOwnProperty("angular"),e.hasOwnProperty("gravity")&&(this.forces.gravity=new THREE.Vector3(e.gravity.x,e.gravity.y,e.gravity.z),this.any_kinematics=!0),e.hasOwnProperty("mass")&&(this.mass=e.mass),e.hasOwnProperty("speed")&&(this.speed=e.speed),e.hasOwnProperty("height")&&(this.modifier_height=e.height),e.hasOwnProperty("wall")&&(this.modifier_wall=e.wall),e.hasOwnProperty("tagalong")&&(this.modifier_tagalong=e.eyelevel),e.hasOwnProperty("billboard")&&(this.modifier_billboard=e.eyelevel)}on_tick(t={}){t.blox;if(this.sequence){let e=Math.floor(t.interval);if(e!=this.sequence_latch){this.sequence_latch=e;for(let t=0;t<this.sequence.length;t++){let e=this.sequence[t];e.time==this.sequence_counter&&this.on_do({description:e})}this.sequence_counter++}}this.on_kinematics(t)}on_kinematics(t){let e=this.blox;if(!this.any_kinematics)return;let i=this.mass?this.mass:1,s=new THREE.Vector3(0,0,0);if(this.inverse_kinematics){let t={x:0,y:0,z:0};if("string"==typeof this.destination){let i=e?e.query({name:this.destination,property:"isObject3D"}):0;i&&(t=i.position.clone(),this.destination=t)}else this.destination&&(t=new THREE.Vector3(this.destination.x,this.destination.y,this.destination.z));this.modifier_height&&(t.y=this.modifier_height||0),s.x+=(t.x-this.position.x)/20,s.y+=(t.y-this.position.y)/20,s.z+=(t.z-this.position.z)/20}Object.entries(this.forces).forEach(([t,e])=>{s.x+=e.x,s.y+=e.y,s.z+=e.z}),this.velocity.x+=s.x/i,this.velocity.y+=s.y/i,this.velocity.z+=s.z/i;let o=this.friction?this.friction:.9;if(this.velocity.x-=this.velocity.x*o*.06,this.velocity.y-=this.velocity.y*o*.06,this.velocity.z-=this.velocity.z*o*.06,this.position.x+=.06*this.velocity.x,this.position.y+=.06*this.velocity.y,this.position.z+=.06*this.velocity.z,this.facing){let t=new THREE.Vector3(-this.velocity.x,0,-this.velocity.z).normalize();var r=(new THREE.Matrix4).lookAt(t,new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));let e=(new THREE.Quaternion).setFromRotationMatrix(r);this.quaternion.rotateTowards(e,.1)}this.mesh&&(this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.copy(this.quaternion))}on_impulse(t){let e=t.linear||0,i=t.angular||0;if(this.any_kinematics=!0,this.inverse_kinematics=!1,this.destination=0,e){let t=new THREE.Vector3(e.x,e.y,e.z);t.applyQuaternion(this.quaternion),this.velocity.add(t)}if(i){let t=new THREE.Quaternion;t.setFromEuler(i),this.quaternion.multiply(t)}}on_goto(t){this.destination=t.destination||0,this.destination?(this.any_kinematics=!0,this.inverse_kinematics=!0):this.inverse_kinematics=!1}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});let s=[];class o{constructor(t){let e=t.description,i=t.blox;e.layer||(e.layer=1),e.filter||(e.filter=1),e.proximity||(e.proximity=1),s.push({props:e,blox:i})}on_tick(t){for(let t=0;t<s.length;t++)for(let e=t+1;e<s.length;e++){let i=s[t],o=s[e];if(!i.blox.mesh||!o.blox.mesh)continue;if(!(i.props.layer&o.props.layer))continue;let r=i.blox.mesh.position.distanceTo(o.blox.mesh.position),n=i.props.proximity+o.props.proximity;r<n&&(i.props.filter&o.props.layer&&i.blox.on_event({name:"on_overlap",blox:i.blox,other:o.blox}),o.props.filter&i.props.layer&&o.blox.on_event({name:"on_overlap",blox:o.blox,other:i.blox})),r<n&&!i.latched?(i.latched=!0,i.blox.on_event({name:"on_enter",blox:i.blox,other:o.blox}),o.blox.on_event({name:"on_enter",blox:o.blox,other:i.blox})):r>=2&&(i.latched=!1)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s extends THREE.OrbitControls{constructor(t){let e=t.description,i=t.blox;i.camera,super(i.camera);let s=e.lookat||{x:0,y:1,z:0};this.target=new THREE.Vector3(s.x,s.y,s.z),this.minDistance=e.minDistance||50,this.maxDistance=e.maxDistance||500,this.update()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t){let e=t.description,i=t.blox;this.parentBehavior=i.query({property:"isObject3D"}),this.parentBehavior&&(this.camera=i.query({property:"isPerspectiveCamera"}),this.camera,this.props=e,this.blox=i,this.forward=new THREE.Vector3(0,0,1),this.backward=new THREE.Vector3(0,0,-1),this.left=new THREE.Euler(0,10*Math.PI/180,0),this.right=new THREE.Euler(0,-10*Math.PI/180,0),document.addEventListener("keydown",this.onKeyDown.bind(this),!1))}onKeyDown(t){let e=this.blox;if(!e||!e.intent)return;this.parentBehavior;switch(t.key){case"w":e.intent.on_impulse({linear:this.forward,angular:0});break;case"s":e.intent.on_impulse({linear:this.backward,angular:0});break;case"a":e.intent.on_impulse({linear:0,angular:this.left});break;case"d":e.intent.on_impulse({linear:0,angular:this.right});break;case 32:e.intent.on_reset({})}}on_tick(t){if(!this.camera)return;if(!(void 0!==window.webkit)){let t=this.parentBehavior,e=new THREE.Vector3(0,3,-10);e.applyMatrix4(t.matrixWorld),this.camera.position.set(e.x,e.y,e.z),this.camera.lookAt(t.position)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});class s{constructor(t,e){this.mesh=new e.constructor(e.description,0),e.add(this.mesh),this.reset(t)}reset(t){let e=t.longevity||{min:50,max:100};this.life=this.lifestart=Math.random()*(e.max-e.min)+e.min,this.gravity=t.gravity||new THREE.Vector3(0,-1,0),this.friction=t.friction||new THREE.Vector3(.9,.9,.9);let i=t.offset||{x:0,y:0,z:0},s=t.radius||1;this.position=new THREE.Vector3(i.x+Math.random()*s,i.y+Math.random()*s,i.z+Math.random()*s);let o=Math.random()*(t.speed.max-t.speed.min)+t.speed.min,r=t.nozzle||{axis1:-10,axis2:10,spin1:0,spin2:360},n=new THREE.Vector3(0,1*o,0),a=Math.random()*(r.axis2-r.axis1)+r.axis1;n.applyAxisAngle(new THREE.Vector3(0,0,1),a*Math.PI/180);let h=Math.random()*(r.spin2-r.spin1)+r.spin1;n.applyAxisAngle(new THREE.Vector3(0,1,0),h*Math.PI/180),this.velocity=n,this.tumbleTime=0;{let t=65536*Math.floor(100*Math.random()+135)+256*Math.floor(100*Math.random()+19)+Math.floor(100*Math.random()+101),e=Math.random()+1,i={art:"ignore",color:t,scale:{x:e,y:e,z:e},doublesided:1,transparent:1};this.mesh.on_reset({description:i})}this.on_tick({interval:0})}on_tick(t){if(this.life<0)return this.mesh.visible=!1,void this.mesh.position.set(0,0,0);this.life--;this.velocity.x=this.velocity.x*this.friction.x+.001*this.gravity.x,this.velocity.y=this.velocity.y*this.friction.y+.001*this.gravity.y,this.velocity.z=this.velocity.z*this.friction.z+.001*this.gravity.z,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.position.z+=this.velocity.z,this.mesh.visible=!0,this.mesh.position.set(this.position.x,this.position.y,this.position.z),(--this.tumbleTime<0||!this.tumbleAxis)&&(this.tumbleTime=Math.floor(50*Math.random()),this.tumbleAxis=new THREE.Vector3(10*Math.random(),10*Math.random(),10*Math.random).normalize()),this.mesh.rotateOnAxis(this.tumbleAxis,.1),this.mesh.material.opacity=1-(this.lifestart-this.life)/this.lifestart}}class o{constructor(t){let e=t.description,i=t.blox;this.props=e,this.particles=[],this.rateCount=0,this.mesh=i.query({property:"isObject3D"}),this.mesh&&(this.mesh.material.visible=!1)}on_tick(t){if(!this.mesh)return;let e=[];for(let i=0;i<this.particles.length;i++){let s=this.particles[i];s.life<0?(s.mesh.visible=!1,e.push(s)):(s.on_tick(t),0)}this.rateCount+=this.props.rate;let i=Math.floor(this.rateCount);for(let t=0;t<i;t++){if(e.length){e.shift().reset(this.props)}else{if(this.particles.length>=this.props.quantity)return;let t=new s(this.props,this.mesh);this.particles.push(t)}this.rateCount-=1}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t){let e=t.description,i=t.blox;this.props=e,this.particles=[],this.rateCount=0,this.parentMesh=i._findByProperty("isObject3D");let s=i.parent.scene;this.parentMesh.material.visible=!1,this.initProton(this.parentMesh,s)}on_tick(t){this.proton.update()}initProton(t,e){let i=this.proton=new Proton,s=this.emitter1=this.createEmitter({p:{x:-100,y:0},Body:this.createMesh("sphere")}),o=this.emitter2=this.createEmitter({p:{x:100,y:0},Body:this.createMesh("cube")});i.addEmitter(s),i.addEmitter(o),i.addRender(new Proton.MeshRender(e)),Proton.Debug.drawEmitter(i,e,s),Proton.Debug.drawEmitter(i,e,o)}createMesh(t){if("sphere"==t)var e=new THREE.SphereGeometry(10,8,8),i=new THREE.MeshLambertMaterial({color:"#ff0000"});else e=new THREE.BoxGeometry(20,20,20),i=new THREE.MeshLambertMaterial({color:"#00ffcc"});return new THREE.Mesh(e,i)}createEmitter(t){var e=new Proton.Emitter;return e.rate=new Proton.Rate(new Proton.Span(5,10),new Proton.Span(.1,.25)),e.addInitialize(new Proton.Mass(1)),e.addInitialize(new Proton.Radius(10)),e.addInitialize(new Proton.Life(2,4)),e.addInitialize(new Proton.Body(t.Body)),e.addInitialize(new Proton.Position(new Proton.BoxZone(100))),e.addInitialize(new Proton.Velocity(200,new Proton.Vector3D(0,1,1),30)),e.addBehaviour(new Proton.Rotate("random","random")),e.addBehaviour(new Proton.Scale(1,.1)),e.addBehaviour(new Proton.Gravity(3)),e.p.x=t.p.x,e.p.y=t.p.y,e.emit(),e}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t){let e=t.description,i=t.blox;if(!e||!e.target)return;let s=i.query(e.target);if(!s||!s.parent)return;let o=e.count||10;for(let t=0;t<o;t++){s.description.name=e.name+t;let i=s.parent.group.push(s.description),o=10*Math.random()-5,r=0,n=10*Math.random()-5;i.mesh&&i.mesh.position.set(o,r,n)}}}},function(t,e,i){"use strict";function s(t){return new Promise((e,i)=>{const s="$importModule$"+Math.random().toString(32).slice(2),o=document.createElement("script"),r=()=>{delete window[s],o.onerror=null,o.onload=null,o.remove(),URL.revokeObjectURL(o.src),o.src=""};o.defer="defer",o.type="module",o.onerror=(()=>{i(new Error(`Failed to import: ${t}`)),r()}),o.onload=(()=>{e(window[s]),r()});const n=`import * as m from "${function(t){const e=document.createElement("a");return e.setAttribute("href",t),e.cloneNode(!1).href}(t)}"; window.${s} = m;`,a=new Blob([n],{type:"text/javascript"});o.src=URL.createObjectURL(a),document.head.appendChild(o)})}i.d(e,"a",function(){return s})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Blox});var _lib_importModule_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17),_BehaviorRenderer_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_BehaviorScene_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(19),_BehaviorCamera_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),_BehaviorLight_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),_BehaviorMesh_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(0),_BehaviorSky_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6),_BehaviorHeart_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(7),_BehaviorText_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(8),_BehaviorTextPanel_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9),_BehaviorIntent_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(10),_BehaviorPhysics_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2),_BehaviorCollide_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(11),_BehaviorOrbit_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(12),_BehaviorWalk_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(13),_BehaviorBounce_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(1),_BehaviorParticles_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(14),_BehaviorProton_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(15),_BehaviorEmitter_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(16);let UUID=0,global_blox_namespace={};class BehaviorGroup{constructor(t){t.description;let e=t.blox;e&&(this.blox=e,e.group=e.behaviors.group=this,this.children=[],this.on_reset(t))}on_reset(t){let e=t.description;if(e&&e.constructor==Array)for(let t=0;t<e.length;t++)this.push(e[t])}push(t){let e=new Blox({description:t,parent:this.blox});return this.children.push(e),e}on_event(t){this.children.forEach(e=>{t.blox=e,e.on_event(t)})}}class BehaviorLoad{}class BehaviorFunctions{constructor(t){this.blox=t.blox,this.chains={},this.blox.on_event=this.on_event.bind(this)}on_event(t){t.blox=this.blox,"on_tick"!=t.name&&this.debug,this._on_specific_named_event(t.name,t),"on_event"!=t.name&&this._on_specific_named_event("on_event",t)}_on_specific_named_event(t,e){e.blox=this.blox;let i=this.chains[t];if(i)for(let t=0;t<i.length;t++){(0,i[t])(e)}}push(t){let e=t.label,i=t.handler,s=t.owner,o=this.chains[e];o||(o=this.chains[e]=[]),o.push(i.bind(s)),this.debug}}class Blox{constructor(t,e=0){"string"==typeof t?(this.parent=e,this.description=t):(this.parent=t.parent||e,this.description=t.description||{}),this.name="blox"+UUID++,this.behaviors={},this.functions=new BehaviorFunctions({blox:this}),this.functions.blox=this,this.add({label:"group"}),this.on_behaviors({description:this.description,parent:this.parent})}on_event(t){}async on_behaviors(t){t.parent;let e=t.description;if("string"==typeof e){let t=await Object(_lib_importModule_js__WEBPACK_IMPORTED_MODULE_0__.a)(e);if(!t)return;let i=Object.keys(t);if(!i.length)return;e=t[i[0]]}if(e&&e.constructor==Object){if(e.load){let t=await Object(_lib_importModule_js__WEBPACK_IMPORTED_MODULE_0__.a)(e.load);if(t){let e=Object.keys(t);if(e.length&&t[e[0]]){let i=t[e[0]];Object.entries(i).forEach(([t,e])=>{this.add({label:t,description:e})})}}delete e.load}Object.entries(e).forEach(([t,e])=>{this.add({label:t,description:e})}),this.on_event({name:"on_loaded",blox:this,loaded:this}),this.parent&&this.parent.on_event({name:"on_blox_added",child:this})}}add(args){let label=args.label,description=args.description,blox=this;if("name"==label){if("string"!=typeof description)return;return this.name=description,void(global_blox_namespace[this.name]=this)}if("parent"==label)return;if("function"==typeof description)return void this.functions.push({label:label,handler:description,owner:this.functions});let className="Behavior"+label.charAt(0).toUpperCase()+label.slice(1),classRef=0,classInst=0,isNew=!0;for(let t=0;;t++){let t=blox[label];if(!t)break;if("object"!=typeof t)return;if(t.constructor.name==className){classInst=t,isNew=!1;break}}if(!classInst)try{classRef=eval(className)}catch(t){classRef=0}if(classRef||classInst){if(blox.on_event({name:"on_behavior_will_add",description:description,blox:blox}),classInst)try{classInst.on_reset&&classInst.on_reset({description:description,blox:blox})}catch(t){}else{try{classInst=new classRef({description:description,blox:blox})}catch(t){return}for(let t of Object.getOwnPropertyNames(Object.getPrototypeOf(classInst))){let e=classInst[t];t.startsWith("on_")&&e instanceof Function&&this.functions.push({label:t,handler:e,owner:classInst})}}return classInst.blox=blox,classInst.description=description,isNew&&(blox.behaviors[label]=classInst,blox[label]=classInst,blox.on_event({name:"on_behavior_added",behavior:classInst,blox:blox})),classInst}{description.name=label,this.behaviors.group;let t=this.behaviors.group.push(description);return t}}query(t){if("string"==typeof t)return global_blox_namespace[t];if(t.constructor!=Object)return null;let e=this;if("*"==t.name){let t=Object.keys(global_blox_namespace),i=Math.floor(t.length*Math.random());e=global_blox_namespace[t[i]]}else t.name&&(e=global_blox_namespace[t.name]);if(!e)return 0;let i=t.all?[]:0;if(t.property){let s=Object.keys(e.behaviors);for(let o=0;o<s.length;o++){let r=s[o],n=e.behaviors[r];if(n[t.property]){if(!i)return n;i.push(n)}}}if(t.instance){let s=Object.keys(e.behaviors);for(let o=0;o<s.length;o++){let r=s[o],n=e.behaviors[r];if(n instanceof t.instance){if(!i)return n;i.push(n)}}}return i}}},function(t,e,i){"use strict"},function(t,e,i){"use strict";i.r(e);var s=i(3),o=i(4),r=i(5),n=i(0),a=i(6),h=i(7),l=i(8),c=i(9),p=i(10),d=i(2),u=i(11),_=i(12),m=i(13),f=i(1),b=i(14),y=i(15),E=i(16);Object.assign(window,{BehaviorRenderer:s.a,BehaviorScene:class extends THREE.Scene{constructor(t){THREE.Loader.extractUrlBase=THREE.LoaderUtils.extractUrlBase,t.description;var e=t.blox;super(),this.isHack=!0,this.updateScene=function(t){e.on_event({blox:e,name:"on_tick",interval:t})}}on_blox_added(t){var e=this;t.child.query({instance:THREE.Object3D,all:!0}).forEach(function(t){e&&(e.add(t),THREE.PerspectiveCamera)})}},BehaviorCamera:o.a,BehaviorLight:r.a,BehaviorMesh:n.a,BehaviorSky:a.a,BehaviorHeart:h.a,BehaviorText:l.a,BehaviorTextPanel:c.a,BehaviorIntent:p.a,BehaviorPhysics:d.b,BehaviorPhysical:d.a,BehaviorCollide:u.a,BehaviorOrbit:_.a,BehaviorWalk:m.a,BehaviorLine:f.b,BehaviorBounce:f.a,BehaviorOscillate:f.c,BehaviorWander:f.e,BehaviorStare:f.d,BehaviorParticles:b.a,BehaviorProton:y.a,BehaviorEmitter:E.a});var v=i(18);e.default=class extends v.a{constructor(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(t,e),this.onBehaviorScene=i.onBehaviorScene}add(t){var e=super.add(t);return"scene"===t.label&&this.onBehaviorScene&&this.onBehaviorScene(e),e}}}]).default;
    exports.default = BloxHack;
    Object.defineProperty(exports, '__esModule', { value: true });
})));